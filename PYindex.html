<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hand Gesture Detection</title>
    <style>
        #video {
            transform: scaleX(-1); /* Mirrored view */
        }
        #gestureText {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 24px;
            color: green;
        }
        #fingerCount {
            position: absolute;
            bottom: 10px;
            left: 10px;
            font-size: 24px;
            color: green;
        }
    </style>
</head>
<body>
    <video id="video" width="640" height="480" autoplay></video>
    <div id="gestureText"></div>
    <div id="fingerCount"></div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/handpose"></script>

    <script>
        const video = document.getElementById('video');
        const gestureText = document.getElementById('gestureText');
        const fingerCount = document.getElementById('fingerCount');
        
        async function setupCamera() {
            const stream = await navigator.mediaDevices.getUserMedia({
                video: true
            });
            video.srcObject = stream;
        }

        async function detectGestures() {
            const model = await handpose.load(); // Load the handpose model
            console.log('Handpose model loaded.');

            const detectHands = async () => {
                const predictions = await model.estimateHands(video); // Estimate hands in the video frame

                if (predictions.length > 0) {
                    console.log('Hand detected with landmarks:', predictions);
                    const landmarks = predictions[0].landmarks; // Get the hand landmarks
                    const gesture = detectGesture(landmarks);

                    gestureText.innerText = `Gesture: ${gesture}`;
                    fingerCount.innerText = `Fingers: ${countExtendedFingers(landmarks)}`;
                } else {
                    gestureText.innerText = 'No hand detected';
                }

                requestAnimationFrame(detectHands); // Keep detecting hands
            };
            detectHands();
        }

        function countExtendedFingers(landmarks) {
            let extendedFingers = 0;

            // Thumb (Extended if tip is up)
            const thumbExtended = landmarks[4][1] < landmarks[3][1];
            // Index (Extended if tip is up)
            const indexExtended = landmarks[8][1] < landmarks[6][1];
            // Middle (Extended if tip is up)
            const middleExtended = landmarks[12][1] < landmarks[10][1];
            // Ring (Extended if tip is up)
            const ringExtended = landmarks[16][1] < landmarks[14][1];
            // Pinky (Extended if tip is up)
            const pinkyExtended = landmarks[20][1] < landmarks[18][1];

            extendedFingers += thumbExtended ? 1 : 0;
            extendedFingers += indexExtended ? 1 : 0;
            extendedFingers += middleExtended ? 1 : 0;
            extendedFingers += ringExtended ? 1 : 0;
            extendedFingers += pinkyExtended ? 1 : 0;

            return extendedFingers;
        }

        function detectGesture(landmarks) {
            const thumbTip = landmarks[4];
            const indexTip = landmarks[8];
            const middleTip = landmarks[12];
            const ringTip = landmarks[16];
            const pinkyTip = landmarks[20];
            const wrist = landmarks[0];

            const thumbExtended = thumbTip[1] < wrist[1];
            const indexExtended = indexTip[1] < landmarks[7][1];
            const middleExtended = middleTip[1] < landmarks[11][1];
            const ringExtended = ringTip[1] < landmarks[15][1];
            const pinkyExtended = pinkyTip[1] < landmarks[19][1];

            // Thumb Up: Thumb extended upwards
            if (thumbExtended && !indexExtended && !middleExtended && !ringExtended && !pinkyExtended) {
                return "Thumb Up";
            }

            // Thumb Down: Thumb pointing downwards
            if (!thumbExtended && !indexExtended && !middleExtended && !ringExtended && !pinkyExtended) {
                return "Thumb Down";
            }

            // Open Palm: All fingers extended
            if (indexExtended && middleExtended && ringExtended && pinkyExtended) {
                return "Open Palm";
            }

            // Closed Fist: All fingers curled (not extended)
            if (!indexExtended && !middleExtended && !ringExtended && !pinkyExtended) {
                return "Closed Fist";
            }

            // Count specific gestures (1, 2, 3, 4 extended fingers)
            const extendedFingers = countExtendedFingers(landmarks);
            switch (extendedFingers) {
                case 1:
                    return "1 Finger";
                case 2:
                    return "2 Fingers";
                case 3:
                    return "3 Fingers";
                case 4:
                    return "4 Fingers";
                default:
                    return "Neutral";
            }
        }

        setupCamera().then(() => {
            detectGestures();
        }).catch(err => {
            console.error('Error setting up the camera: ', err);
        });
    </script>
</body>
</html>
